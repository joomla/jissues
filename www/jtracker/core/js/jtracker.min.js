var JTracker={};JTracker.preview=function(e,t){var s=$(t);s.html(g11n3t("Loading preview...")),$.post("/preview",{text:$(e).val()},function(e){s.empty(),e.error?s.html(e.error):e.data.length?s.html(e.data):s.html(g11n3t("Invalid response."))})},JTracker.submitComment=function(e,t,s,r){var a=$(s),l=$(t);l.html(g11n3t("Submitting comment...")),$.post("/submit/comment",{text:$("#comment").val(),issue_number:e},function(e){e.data?e.error?l.html(e.error):(l.html(e.message),a.html(a.html()+tmpl(r,e.data)),$("#comment").val(""),$("tbody.files").empty(),JTracker.submitTestWithComment(a,"tplNewTestResult")):l.html(g11n3t("Invalid response."))})},JTracker.submitVote=function(e,t){var s=$(t),r=$("input[name=importanceRadios]").filter(":checked").val(),a=$("input[name=experiencedRadios]").filter(":checked").val();s.addClass("disabled").removeAttr("href").removeAttr("onclick").html(g11n3t("Adding vote...")),$.post("/submit/vote",{issueId:e,experienced:a,importance:r},function(e){e.error?s.addClass("btn-danger").removeClass("btn-success").html(e.error):(s.html(e.message),e.data.votes>0&&($("div[id=experienced]").html(e.data.experienced+"/"+e.data.votes),$("div[id=importance]").html(e.data.importanceScore.toFixed(2)),$("div#issue-votes").show()))})},JTracker.submitTest=function(e,t,s,r,a,l){var n=$(t),i=$(s),o=$("input[name=tested]").filter(":checked").val(),u=$(r).val(),m=$(a).val();n.html(g11n3t("Submitting test result...")),$.post("/submit/testresult",{issueId:e,result:o,comment:u,sha:m},function(e){if(e.error)n.addClass("btn-danger").removeClass("btn-success").html(e.error);else{n.html(e.message);var t=$.parseJSON(e.data);JTracker.updateTests(t.testResults.testsSuccess,t.testResults.testsFailure),i.html(i.html()+tmpl(l,t.event)),$("#current-test-result").val(o),$(".comment-test-result").prop("checked",!1),$("#comment-test-result-"+o).prop("checked",!0)}})},JTracker.submitTestWithComment=function(e,t){var s=$("#issue-id").val(),r=e,a=$("input[name=comment-tested]").filter(":checked").val(),l=$("#current-test-result").val();a&&l!=a&&$.post("/submit/testresult",{issueId:s,result:a},function(e){if(e.error)r.html(e.error);else{$(".test-result").prop("checked",!1),$("#test-result-"+a).prop("checked",!0),$(".comment-test-result").prop("checked",!1),$("#comment-test-result-"+a).prop("checked",!0),$("#current-test-result").val(a);var s=$.parseJSON(e.data);JTracker.updateTests(s.testResults.testsSuccess,s.testResults.testsFailure),r.html(r.html()+tmpl(t,s.event))}})},JTracker.alterTest=function(e,t,s,r){var a=$(t),l=$(s),n=$("select[name=altered]").val(),i=$("input[name=altered-user]").val();return""==i?void a.html(g11n3t("Please select a user")):(a.html(g11n3t("Submitting test result...")),void $.post("/alter/testresult",{issueId:e,user:i,result:n},function(e){if(e.error)a.addClass("btn-danger").removeClass("btn-success").html(e.error);else{a.html(e.message);var t=$.parseJSON(e.data);JTracker.updateTests(t.testResults.testsSuccess,t.testResults.testsFailure),l.html(l.html()+tmpl(r,t.event))}}))},JTracker.updateTests=function(e,t){$("#usertests-success-num").text(e.length),$("#usertests-success").text(e.join(", ")),$("#usertests-fail-num").text(t.length),$("#usertests-fail").text(t.join(", "))},JTracker.getContrastColor=function(e){var t=parseInt(e.substr(0,2),16),s=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16),a=(299*t+587*s+114*r)/1e3;return a>=128?"black":"white"},JTracker.setupAtJS=function(e,t){var s=$.map(["smile","iphone","girl","smiley","heart","kiss","copyright","coffee","a","ab","airplane","alien","ambulance","angel","anger","angry","arrow_forward","arrow_left","arrow_lower_left","arrow_lower_right","arrow_right","arrow_up","arrow_upper_left","arrow_upper_right","art","astonished","atm","b","baby","baby_chick","baby_symbol","balloon","bamboo","bank","barber","baseball","basketball","bath","bear","beer","beers","beginner","bell","bento","bike","bikini","bird","birthday","blue_car","blue_heart","blush","boar","boat","bomb","book","boot","bouquet","bow","bowtie","boy","bread","briefcase","broken_heart","bug","bulb","person_with_blond_hair","phone","pig","pill","pisces","point_down","point_left","point_right","point_up","point_up_2","police_car","poop","post_office","postbox","pray","princess","punch","purple_heart","question","rabbit","racehorse","radio","up","us","v","vhs","vibration_mode","virgo","vs","walking","warning","watermelon","wave","wc","wedding","whale","wheelchair","wind_chime","wink","wolf","woman","womans_hat","womens","x","yellow_heart","zap","zzz","+1","-1","tongue"],function(e,t){return{key:e,name:e}}),r={at:":",data:s,tpl:"<li data-value=':${key}:'><img src='https://assets-cdn.github.com/images/icons/emoji/${key}.png' height='20' width='20' /> ${name}</li>"},a={at:"@",search_key:"username",callbacks:{remote_filter:function(e,t){$.getJSON("/fetch/users",{q:e},function(e){t(e.data)})}},tpl:"<li data-value='@${username}'><img src='/images/avatars/${username}.png' height='20' width='20'> ${username} <small>${name}</small></li>"},l={at:"#",search_key:"issue_number",callbacks:{remote_filter:function(e,t){$.getJSON("/fetch/issues",{q:e},function(e){t(e.data)})}},tpl:"<li data-value='#${issue_number}'>${issue_number} <small>${title}</small></li>"};$("#"+e).atwho(r).atwho(a).atwho(l)};