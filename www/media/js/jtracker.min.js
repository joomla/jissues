!function(a,b){"use strict";a.JTracker={preview:function(a,c){var d=b(c);d.html(g11n3t("Loading preview...")),b.post("/preview",{text:b(a).val()},function(a){d.empty(),a.error?d.html(a.error):a.data.length?d.html(a.data):d.html(g11n3t("Invalid response."))})},submitComment:function(a,c,d,e){var f=b(d),g=b(c);g.html(g11n3t("Submitting comment...")),b.post("/submit/comment",{text:b("#comment").val(),issue_number:a},function(a){a.data?a.error?g.html(a.error):(g.html(a.message),f.html(f.html()+tmpl(e,a.data)),b("#comment").val(""),b("tbody.files").empty(),JTracker.submitTestWithComment(f,"tplNewTestResult")):g.html(g11n3t("Invalid response."))})},submitVote:function(a,c){var d=b(c),e=b("input[name=importanceRadios]").filter(":checked").val(),f=b("input[name=experiencedRadios]").filter(":checked").val();d.addClass("disabled").removeAttr("href").removeAttr("onclick").html(g11n3t("Adding vote...")),b.post("/submit/vote",{issueId:a,experienced:f,importance:e},function(a){a.error?d.addClass("btn-danger").removeClass("btn-success").html(a.error):(d.html(a.message),a.data.votes>0&&(b("div[id=experienced]").html(a.data.experienced+"/"+a.data.votes),b("div[id=importance]").html(a.data.importanceScore.toFixed(2)),b("div#issue-votes").show()))})},submitTest:function(a,c,d,e,f,g){var h=b(c),i=b(d),j=b("input[name=tested]").filter(":checked").val(),k=b(e).val(),l=b(f).val();h.html(g11n3t("Submitting test result...")),b.post("/submit/testresult",{issueId:a,result:j,comment:k,sha:l},function(a){if(a.error)h.addClass("btn-danger").removeClass("btn-success").html(a.error);else{h.addClass("text-success").html(a.message);var c=b.parseJSON(a.data);JTracker.updateTests(c.testResults.testsSuccess,c.testResults.testsFailure),i.html(i.html()+tmpl(g,c.event)),b("#current-test-result").val(j),b(".comment-test-result").prop("checked",!1),b("#comment-test-result-"+j).prop("checked",!0),b("#testContainer").delay(1e3).slideUp()}})},submitTestWithComment:function(a,c){var d=b("#issue-id").val(),e=b("input[name=comment-tested]").filter(":checked").val(),f=b("#current-test-result").val();e&&f!=e&&b.post("/submit/testresult",{issueId:d,result:e},function(d){if(d.error)a.html(d.error);else{b(".test-result").prop("checked",!1),b("#test-result-"+e).prop("checked",!0),b(".comment-test-result").prop("checked",!1),b("#comment-test-result-"+e).prop("checked",!0),b("#current-test-result").val(e);var f=b.parseJSON(d.data);JTracker.updateTests(f.testResults.testsSuccess,f.testResults.testsFailure),a.html(a.html()+tmpl(c,f.event)),b("#testContainer").delay(1e3).slideUp()}})},alterTest:function(a,c,d,e,f){var g=b(c),h=b(d),i=b(e).val(),j=b("select[name=altered]").val(),k=b("input[name=altered-user]").val();return""==k?void g.html(g11n3t("Please select a user")):(g.html(g11n3t("Submitting test result...")),void b.post("/alter/testresult",{issueId:a,user:k,result:j,sha:i},function(a){if(a.error)g.addClass("btn-danger").removeClass("btn-success").html(a.error);else{g.addClass("text-success").html(a.message);var c=b.parseJSON(a.data);JTracker.updateTests(c.testResults.testsSuccess,c.testResults.testsFailure),h.html(h.html()+tmpl(f,c.event))}}))},updateTests:function(a,c){b("#usertests-success-num").text(a.length),b("#usertests-success").text(a.join(", ")),b("#usertests-fail-num").text(c.length),b("#usertests-fail").text(c.join(", "))},getContrastColor:function(a){var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16),e=(299*b+587*c+114*d)/1e3;return e>=128?"black":"white"},setupAtJS:function(a,c){var d=b.map(["smile","iphone","girl","smiley","heart","kiss","copyright","coffee","a","ab","airplane","alien","ambulance","angel","anger","angry","arrow_forward","arrow_left","arrow_lower_left","arrow_lower_right","arrow_right","arrow_up","arrow_upper_left","arrow_upper_right","art","astonished","atm","b","baby","baby_chick","baby_symbol","balloon","bamboo","bank","barber","baseball","basketball","bath","bear","beer","beers","beginner","bell","bento","bike","bikini","bird","birthday","blue_car","blue_heart","blush","boar","boat","bomb","book","boot","bouquet","bow","bowtie","boy","bread","briefcase","broken_heart","bug","bulb","person_with_blond_hair","phone","pig","pill","pisces","point_down","point_left","point_right","point_up","point_up_2","police_car","poop","post_office","postbox","pray","princess","punch","purple_heart","question","rabbit","racehorse","radio","up","us","v","vhs","vibration_mode","virgo","vs","walking","warning","watermelon","wave","wc","wedding","whale","wheelchair","wind_chime","wink","wolf","woman","womans_hat","womens","x","yellow_heart","zap","zzz","+1","-1","tongue"],function(a,b){return{key:a,name:a}}),e={at:":",data:d,displayTpl:"<li data-value=':${key}:'><img src='https://assets-cdn.github.com/images/icons/emoji/${key}.png' height='20' width='20' /> ${name}</li>",insertTpl:":${name}:"},f={at:"@",searchKey:"username",callbacks:{remoteFilter:function(a,c){b.getJSON("/fetch/users",{q:a},function(a){c(a.data)})}},displayTpl:"<li data-value='@${username}'><img src='/images/avatars/${username}.png' height='20' width='20'> ${username} <small>${name}</small></li>",insertTpl:"@${username}"},g={at:"#",searchKey:"issue_number",callbacks:{remoteFilter:function(a,c){b.getJSON("/fetch/issues",{q:a},function(a){c(a.data)})}},displayTpl:"<li data-value='#${issue_number}'>${issue_number} <small>${title}</small></li>",insertTpl:"#${issue_number}"};b("#"+a).atwho(e).atwho(f).atwho(g)}}}(window,jQuery);