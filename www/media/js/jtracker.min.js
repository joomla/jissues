var JTracker={};JTracker.preview=function(a,b){var c=$(b);c.html(g11n3t("Loading preview...")),$.post("/preview",{text:$(a).val()},function(a){c.empty(),a.error?c.html(a.error):a.data.length?c.html(a.data):c.html(g11n3t("Invalid response."))})},JTracker.submitComment=function(a,b,c,d){var e=$(c),f=$(b);f.html(g11n3t("Submitting comment...")),$.post("/submit/comment",{text:$("#comment").val(),issue_number:a},function(a){a.data?a.error?f.html(a.error):(f.html(a.message),e.html(e.html()+tmpl(d,a.data)),$("#comment").val(""),$("tbody.files").empty(),JTracker.submitTestWithComment(e,"tplNewTestResult")):f.html(g11n3t("Invalid response."))})},JTracker.submitVote=function(a,b){var c=$(b),d=$("input[name=importanceRadios]").filter(":checked").val(),e=$("input[name=experiencedRadios]").filter(":checked").val();c.addClass("disabled").removeAttr("href").removeAttr("onclick").html(g11n3t("Adding vote...")),$.post("/submit/vote",{issueId:a,experienced:e,importance:d},function(a){a.error?c.addClass("btn-danger").removeClass("btn-success").html(a.error):(c.html(a.message),a.data.votes>0&&($("div[id=experienced]").html(a.data.experienced+"/"+a.data.votes),$("div[id=importance]").html(a.data.importanceScore.toFixed(2)),$("div#issue-votes").show()))})},JTracker.submitTest=function(a,b,c,d,e,f){var g=$(b),h=$(c),i=$("input[name=tested]").filter(":checked").val(),j=$(d).val(),k=$(e).val();g.html(g11n3t("Submitting test result...")),$.post("/submit/testresult",{issueId:a,result:i,comment:j,sha:k},function(a){if(a.error)g.addClass("btn-danger").removeClass("btn-success").html(a.error);else{g.addClass("text-success").html(a.message);var b=$.parseJSON(a.data);JTracker.updateTests(b.testResults.testsSuccess,b.testResults.testsFailure),h.html(h.html()+tmpl(f,b.event)),$("#current-test-result").val(i),$(".comment-test-result").prop("checked",!1),$("#comment-test-result-"+i).prop("checked",!0),$("#testContainer").delay(1e3).slideUp()}})},JTracker.submitTestWithComment=function(a,b){var c=$("#issue-id").val(),d=a,e=$("input[name=comment-tested]").filter(":checked").val(),f=$("#current-test-result").val();e&&f!=e&&$.post("/submit/testresult",{issueId:c,result:e},function(a){if(a.error)d.html(a.error);else{$(".test-result").prop("checked",!1),$("#test-result-"+e).prop("checked",!0),$(".comment-test-result").prop("checked",!1),$("#comment-test-result-"+e).prop("checked",!0),$("#current-test-result").val(e);var c=$.parseJSON(a.data);JTracker.updateTests(c.testResults.testsSuccess,c.testResults.testsFailure),d.html(d.html()+tmpl(b,c.event)),$("#testContainer").delay(1e3).slideUp()}})},JTracker.alterTest=function(a,b,c,d,e){var f=$(b),g=$(c),h=$(d).val(),i=$("select[name=altered]").val(),j=$("input[name=altered-user]").val();return""==j?void f.html(g11n3t("Please select a user")):(f.html(g11n3t("Submitting test result...")),void $.post("/alter/testresult",{issueId:a,user:j,result:i,sha:h},function(a){if(a.error)f.addClass("btn-danger").removeClass("btn-success").html(a.error);else{f.addClass("text-success").html(a.message);var b=$.parseJSON(a.data);JTracker.updateTests(b.testResults.testsSuccess,b.testResults.testsFailure),g.html(g.html()+tmpl(e,b.event))}}))},JTracker.updateTests=function(a,b){$("#usertests-success-num").text(a.length),$("#usertests-success").text(a.join(", ")),$("#usertests-fail-num").text(b.length),$("#usertests-fail").text(b.join(", "))},JTracker.getContrastColor=function(a){var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16),e=(299*b+587*c+114*d)/1e3;return e>=128?"black":"white"},JTracker.setupAtJS=function(a,b){var c=$.map(["smile","iphone","girl","smiley","heart","kiss","copyright","coffee","a","ab","airplane","alien","ambulance","angel","anger","angry","arrow_forward","arrow_left","arrow_lower_left","arrow_lower_right","arrow_right","arrow_up","arrow_upper_left","arrow_upper_right","art","astonished","atm","b","baby","baby_chick","baby_symbol","balloon","bamboo","bank","barber","baseball","basketball","bath","bear","beer","beers","beginner","bell","bento","bike","bikini","bird","birthday","blue_car","blue_heart","blush","boar","boat","bomb","book","boot","bouquet","bow","bowtie","boy","bread","briefcase","broken_heart","bug","bulb","person_with_blond_hair","phone","pig","pill","pisces","point_down","point_left","point_right","point_up","point_up_2","police_car","poop","post_office","postbox","pray","princess","punch","purple_heart","question","rabbit","racehorse","radio","up","us","v","vhs","vibration_mode","virgo","vs","walking","warning","watermelon","wave","wc","wedding","whale","wheelchair","wind_chime","wink","wolf","woman","womans_hat","womens","x","yellow_heart","zap","zzz","+1","-1","tongue"],function(a,b){return{key:a,name:a}}),d={at:":",data:c,tpl:"<li data-value=':${key}:'><img src='https://assets-cdn.github.com/images/icons/emoji/${key}.png' height='20' width='20' /> ${name}</li>"},e={at:"@",search_key:"username",callbacks:{remote_filter:function(a,b){$.getJSON("/fetch/users",{q:a},function(a){b(a.data)})}},tpl:"<li data-value='@${username}'><img src='/images/avatars/${username}.png' height='20' width='20'> ${username} <small>${name}</small></li>"},f={at:"#",search_key:"issue_number",callbacks:{remote_filter:function(a,b){$.getJSON("/fetch/issues",{q:a},function(a){b(a.data)})}},tpl:"<li data-value='#${issue_number}'>${issue_number} <small>${title}</small></li>"};$("#"+a).atwho(d).atwho(e).atwho(f)};