!function(e,t){"use strict";e.JTracker={basePath:"",baseUrl:"",preview:function(e,s){var a=t(s);a.html("Loading preview..."),t.post("/preview",{text:t(e).val()},(function(e){a.empty(),e.error?a.html(e.error):e.data.length?a.html(e.data):a.html("Invalid response.")}))},submitComment:function(e,s,a,r,l){var i=t(a),n=t(s),o=t(l).val();n.html("Submitting comment..."),t.post("/submit/comment",{text:t("#comment").val(),issue_number:e,sha:o},(function(e){e.data?e.error?n.html(e.error):(n.html(e.message),i.html(i.html()+tmpl(r,e.data)),t("#comment").val(""),t("tbody.files").empty(),t("input[name=comment-tested]").filter(":checked").val()>0&&JTracker.submitTestWithComment(i,"tplNewTestResult")):n.html("Invalid response.")}))},submitVote:function(e,s){var a=t(s),r=t("input[name=importanceRadios]").filter(":checked").val(),l=t("input[name=experiencedRadios]").filter(":checked").val();a.addClass("disabled").removeAttr("href").removeAttr("onclick").html("Adding vote..."),t.post("/submit/vote",{issueId:e,experienced:l,importance:r},(function(e){e.error?a.addClass("btn-danger").removeClass("btn-success").html(e.error):(a.html(e.message),e.data.votes>0&&(t("div[id=experienced]").html(e.data.experienced+"/"+e.data.votes),t("div[id=importance]").html(e.data.importanceScore.toFixed(2)),t("div#issue-votes").show()))}))},submitTest:function(e,s,a,r,l,i){var n=t(s),o=t(a),u=t("input[name=tested]").filter(":checked").val(),m=t(r).val(),c=t(l).val();n.html("Submitting test result..."),t.post("/submit/testresult",{issueId:e,result:u,comment:m,sha:c},(function(e){if(e.error)n.addClass("btn-danger").removeClass("btn-success").html(e.error);else{n.addClass("text-success").html(e.message);var s=t.parseJSON(e.data);JTracker.updateTests(s.testResults.testsSuccess,s.testResults.testsFailure),o.html(o.html()+tmpl(i,s.event)),t("#current-test-result").val(u),t(".comment-test-result").prop("checked",!1),t("#comment-test-result-"+u).prop("checked",!0),t("#testContainer").delay(1e3).slideUp()}}))},submitTestWithComment:function(e,s){var a=t("#issue-id").val(),r=t("input[name=comment-tested]").filter(":checked").val(),l=t("#current-test-result").val();r&&l!=r&&t.post("/submit/testresult",{issueId:a,result:r},(function(a){if(a.error)e.html(a.error);else{t(".test-result").prop("checked",!1),t("#test-result-"+r).prop("checked",!0),t(".comment-test-result").prop("checked",!1),t("#comment-test-result-"+r).prop("checked",!0),t("#current-test-result").val(r);var l=t.parseJSON(a.data);JTracker.updateTests(l.testResults.testsSuccess,l.testResults.testsFailure),e.html(e.html()+tmpl(s,l.event)),t("#testContainer").delay(1e3).slideUp()}}))},alterTest:function(e,s,a,r,l){var i=t(s),n=t(a),o=t(r).val(),u=t("select[name=altered]").val(),m=t("input[name=altered-user]").val();""!=m?(i.html("Submitting test result..."),t.post("/alter/testresult",{issueId:e,user:m,result:u,sha:o},(function(e){if(e.error)i.addClass("btn-danger").removeClass("btn-success").html(e.error);else{i.addClass("text-success").html(e.message);var s=t.parseJSON(e.data);JTracker.updateTests(s.testResults.testsSuccess,s.testResults.testsFailure),n.html(n.html()+tmpl(l,s.event))}}))):i.html("Please select a user")},updateTests:function(e,s){t("#usertests-success-num").text(e.length),t("#usertests-success").text(e.join(", ")),t("#usertests-fail-num").text(s.length),t("#usertests-fail").text(s.join(", "))},getContrastColor:function(e){return(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3>=128?"black":"white"},setupAtJS:function(e,s){var a={at:":",data:t.map(["smile","iphone","girl","smiley","heart","kiss","copyright","coffee","a","ab","airplane","alien","ambulance","angel","anger","angry","arrow_forward","arrow_left","arrow_lower_left","arrow_lower_right","arrow_right","arrow_up","arrow_upper_left","arrow_upper_right","art","astonished","atm","b","baby","baby_chick","baby_symbol","balloon","bamboo","bank","barber","baseball","basketball","bath","bear","beer","beers","beginner","bell","bento","bike","bikini","bird","birthday","blue_car","blue_heart","blush","boar","boat","bomb","book","boot","bouquet","bow","bowtie","boy","bread","briefcase","broken_heart","bug","bulb","person_with_blond_hair","phone","pig","pill","pisces","point_down","point_left","point_right","point_up","point_up_2","police_car","poop","post_office","postbox","pray","princess","punch","purple_heart","question","rabbit","racehorse","radio","up","us","v","vhs","vibration_mode","virgo","vs","walking","warning","watermelon","wave","wc","wedding","whale","wheelchair","wind_chime","wink","wolf","woman","womans_hat","womens","x","yellow_heart","zap","zzz","+1","-1","tongue"],(function(e,t){return{key:e,name:e}})),displayTpl:"<li data-value=':${key}:'><img src='https://assets-cdn.github.com/images/icons/emoji/${key}.png' height='20' width='20' /> ${name}</li>",insertTpl:":${name}:"},r={at:"@",searchKey:"username",callbacks:{remoteFilter:function(e,s){t.getJSON("/fetch/users",{q:e},(function(e){s(e.data)}))}},displayTpl:"<li data-value='@${username}'><img src='/images/avatars/${username}.png' height='20' width='20'> ${username} <small>${name}</small></li>",insertTpl:"@${username}"},l={at:"#",searchKey:"issue_number",callbacks:{remoteFilter:function(e,s){t.getJSON("/fetch/issues",{q:e},(function(e){s(e.data)}))}},displayTpl:"<li data-value='#${issue_number}'>${issue_number} <small>${title}</small></li>",insertTpl:"#${issue_number}"};t("#"+e).atwho(a).atwho(r).atwho(l)}}}(window,jQuery);